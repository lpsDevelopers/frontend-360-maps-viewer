<!-- CSV Locations Component Template -->
<div class="csv-locations-container">
  <!-- Header -->
  <div class="csv-header">
    <h4>
      <i class="fas fa-file-csv" aria-hidden="true"></i>
      Cargar CSV
    </h4>
  </div>

  <!-- File Upload Section -->
  <div class="csv-upload-section">
    <input
      #fileInput
      type="file"
      accept=".csv"
      (change)="onFileSelected($event)"
      style="display: none;">

    <button
      class="upload-btn"
      (click)="onSelectCsvFile()"
      [disabled]="csvState.loading"
      type="button">
      <i class="fas fa-upload" aria-hidden="true"></i>
      <span>Seleccionar archivo CSV</span>
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="csvState.loading" class="csv-loading" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <p>Procesando CSV...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="csvState.error && !csvState.loading"
       class="csv-error"
       role="alert"
       aria-live="assertive">
    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
    <p>{{ csvState.error }}</p>
    <button class="retry-btn" (click)="onSelectCsvFile()" type="button">
      <i class="fas fa-redo" aria-hidden="true"></i>
      Intentar de nuevo
    </button>
  </div>

  <!-- Success State -->
  <div *ngIf="csvState.locations.length > 0 && !csvState.loading && !csvState.error"
       class="csv-success">
    <div class="csv-info">
      <div class="file-info">
        <i class="fas fa-check-circle success-icon" aria-hidden="true"></i>
        <div class="file-details">
          <p class="file-name">{{ csvState.fileName }}</p>
          <p class="locations-count">
            {{ csvState.locations.length }} ubicaciones cargadas
          </p>
        </div>
      </div>

      <div class="csv-actions">
        <button
          class="clear-btn"
          (click)="clearCsv()"
          type="button"
          title="Limpiar CSV">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>
    </div>

    <!-- CSV Data Preview -->
    <div class="csv-preview">
      <div class="preview-header">
        <h5>
          <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
          Coordenadas encontradas ({{ csvState.locations.length }})
        </h5>
        <div class="view-controls" *ngIf="csvState.locations.length > 5">
          <button
            class="toggle-view-btn"
            (click)="toggleExpandedView()"
            type="button">
            <i class="fas" [class.fa-expand]="!isExpandedView" [class.fa-compress]="isExpandedView"></i>
            {{ isExpandedView ? 'Contraer' : 'Ver todos' }}
          </button>
        </div>
      </div>

      <!-- Locations List - Always show, with optional scrolling -->
      <div class="locations-list-container"
           [class.expanded]="isExpandedView || csvState.locations.length <= 5"
           [class.collapsed]="!isExpandedView && csvState.locations.length > 5">

        <div class="locations-preview">
          <div class="location-item" *ngFor="let location of csvState.locations; let i = index; trackBy: trackByIndex">
            <span class="location-index">#{{ i + 1 }}</span>
            <span class="location-marker">
              <i class="fas fa-circle" style="color: #800080;" aria-hidden="true"></i>
            </span>
            <span class="location-coords">
              <strong>{{ location.latitud?.toFixed(6) }}</strong>, <strong>{{ location.longitud?.toFixed(6) }}</strong>
            </span>
          </div>
        </div>

        <!-- Fade overlay for collapsed view -->
        <div class="fade-overlay" *ngIf="!isExpandedView && csvState.locations.length > 5"></div>
      </div>

      <!-- Statistics Summary -->
      <div class="locations-stats" *ngIf="csvState.locations.length > 0">
        <div class="stats-row">
          <div class="stat-item">
            <i class="fas fa-map-pin" aria-hidden="true"></i>
            <span>{{ csvState.locations.length }} puntos</span>
          </div>
          <div class="stat-item" *ngIf="getCoordinateRange() as range">
            <i class="fas fa-expand-arrows-alt" aria-hidden="true"></i>
            <span class="coord-range">{{ range }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Text -->
  <div class="csv-help" *ngIf="csvState.locations.length === 0 && !csvState.loading">
    <div class="help-content">
      <i class="fas fa-info-circle" aria-hidden="true"></i>
      <div class="help-text">
        <p><strong>Formato CSV esperado:</strong></p>
        <ul>
          <li><strong>Latitud:</strong> latitudS, latitude, latitud, lat</li>
          <li><strong>Longitud:</strong> longitudW, longitude, longitud, lng</li>
          <li>Separador: coma (,)</li>
          <li>Primera fila debe contener encabezados</li>
          <li>Acepta n√∫meros negativos y decimales</li>
          <li>Ejemplo: -12.0924515, -76.9837671</li>
        </ul>
      </div>
    </div>
  </div>
</div>
